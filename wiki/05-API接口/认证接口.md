# 认证接口

> **版本**: v1.1.0  
> **更新日期**: 2026-02-21  
> **作者**: Vaultly Team  
> **文档类型**: API 文档

---

## 版本历史

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| v1.0.0 | 2026-02-20 | 初始版本 | Vaultly Team |
| v1.1.0 | 2026-02-21 | 移除生物识别相关接口 | Vaultly Team |

---

## 一、AuthService

### 1.1 主密码管理

#### setupMasterPassword

设置主密码（首次使用）。

```dart
Future<void> setupMasterPassword(String password)
```

**参数：**
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| password | string | 是 | 主密码 |

**返回：** void

**异常：**
- `invalidPassword`: 密码不符合策略

---

#### verifyMasterPassword

验证主密码是否正确。

```dart
Future<bool> verifyMasterPassword(String password)
```

**参数：**
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| password | string | 是 | 主密码 |

**返回：** bool - 密码是否正确

---

#### isPasswordSet

检查是否已设置主密码。

```dart
Future<bool> isPasswordSet()
```

**返回：** bool - 是否已设置密码

---

### 1.2 会话管理

#### unlock

使用主密码解锁保险库。

```dart
Future<bool> unlock(String password)
```

**参数：**
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| password | string | 是 | 主密码 |

**返回：** bool - 解锁是否成功

**异常：**
- `tooManyAttempts`: 尝试次数过多
- `vaultLocked`: 保险库已锁定

---

#### lock

锁定保险库。

```dart
void lock()
```

**返回：** void

---

#### isUnlocked

检查保险库是否已解锁。

```dart
bool isUnlocked()
```

**返回：** bool - 是否已解锁

---

#### getSessionState

获取当前会话状态。

```dart
SessionState getSessionState()
```

**返回：** SessionState
```dart
class SessionState {
  bool isUnlocked;
  DateTime? lastActiveAt;
  int lockTimeout;
}
```

---

### 1.3 生物识别

#### enableBiometric

启用生物识别解锁。

```dart
Future<void> enableBiometric()
```

**返回：** void

**前提：** 设备支持生物识别且已配置

---

#### disableBiometric

禁用生物识别解锁。

```dart
Future<void> disableBiometric()
```

**返回：** void

---

#### unlockWithBiometric

使用生物识别解锁。

```dart
Future<bool> unlockWithBiometric()
```

**返回：** bool - 解锁是否成功

---

#### isBiometricEnabled

检查生物识别是否已启用。

```dart
Future<bool> isBiometricEnabled()
```

**返回：** bool - 生物识别是否启用

---

## 二、BiometricService

### 2.1 生物识别检查

#### isAvailable

检查生物识别是否可用。

```dart
Future<bool> isAvailable()
```

**返回：** bool - 生物识别是否可用

---

#### getAvailableTypes

获取可用的生物识别类型。

```dart
Future<List<BiometricType>> getAvailableTypes()
```

**返回：** List<BiometricType>
```dart
enum BiometricType {
  fingerprint,
  face,
  iris,
}
```

---

### 2.2 认证

#### authenticate

执行生物识别认证。

```dart
Future<bool> authenticate({
  String reason = '解锁保险库',
})
```

**参数：**
| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| reason | string | 否 | '解锁保险库' | 认证原因 |

**返回：** bool - 认证是否成功

---

## 三、使用示例

### 3.1 首次设置密码

```dart
final authService = AuthService();

if (!await authService.isPasswordSet()) {
  await authService.setupMasterPassword('SecureP@ssw0rd');
}
```

### 3.2 解锁保险库

```dart
final authService = AuthService();

// 尝试主密码解锁
final success = await authService.unlock('SecureP@ssw0rd');
if (success) {
  // 进入保险库
}
```

---

## 四、相关文档

- [认证模块](../03-模块设计/认证模块.md) - 认证模块设计
- [安全架构](../02-架构设计/安全架构.md) - 安全设计
- [接口概览](./接口概览.md) - 接口概览
