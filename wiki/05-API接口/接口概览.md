# 接口概览

## 一、接口清单

### 1.1 服务接口分类

| 分类 | 数量 | 说明 |
|------|------|------|
| **认证接口** | 8 | 登录、解锁、会话管理 |
| **保险库接口** | 15 | 条目 CRUD、搜索 |
| **TOTP 接口** | 6 | TOTP 生成、验证 |
| **同步接口** | 10 | WebDAV 同步管理 |
| **设置接口** | 8 | 应用设置 |

### 1.2 接口访问控制

| 接口类型 | 访问要求 |
|---------|----------|
| 认证接口 | 无需认证 |
| 保险库接口 | 需要解锁会话 |
| TOTP 接口 | 需要解锁会话 |
| 同步接口 | 需要解锁会话 |
| 设置接口 | 需要解锁会话 |

---

## 二、接口规范

### 2.1 RESTful 风格

内部服务接口使用 Dart 方法调用，遵循以下规范：

```dart
// 命名规范
class VaultService {
  // CRUD 操作
  Future<VaultEntry> getEntry(String id);
  Future<String> addEntry(VaultEntry entry);
  Future<void> updateEntry(VaultEntry entry);
  Future<void> deleteEntry(String id);
  
  // 查询操作
  Future<List<VaultEntry>> getAllEntries();
  Future<List<VaultEntry>> searchEntries(String query);
}
```

### 2.2 返回类型

| 类型 | 说明 |
|------|------|
| void | 操作成功，无返回值 |
| Future\<T\> | 异步返回 |
| Stream\<T\> | 流式返回（如同步状态） |

---

## 三、错误处理

### 3.1 异常类型

```dart
class VaultException implements Exception {
  final String message;
  final VaultErrorCode code;
  final dynamic details;
}

enum VaultErrorCode {
  // 认证错误
  invalidPassword,
  biometricFailed,
  tooManyAttempts,
  vaultLocked,
  
  // 数据错误
  entryNotFound,
  invalidEntry,
  encryptionFailed,
  decryptionFailed,
  
  // 同步错误
  syncFailed,
  conflictDetected,
  networkError,
  
  // 通用错误
  unknown,
}
```

### 3.2 错误响应

```dart
class Result<T> {
  final T? data;
  final VaultException? error;
  final bool isSuccess;
  
  factory Result.success(T data) => Result._(data, null, true);
  factory Result.failure(VaultException error) => Result._(null, error, false);
}
```

---

## 四、相关文档

- [认证接口](./认证接口.md) - 认证服务接口
- [保险库接口](./保险库接口.md) - 保险库服务接口
- [同步接口](./同步接口.md) - 同步服务接口
- [整体架构](../02-架构设计/整体架构.md) - 系统架构
