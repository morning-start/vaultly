# 用户认证功能

> 功能文档 - 描述用户认证的功能需求、用户场景、验收标准

---

## 一、功能概述

### 1.1 功能描述

用户认证功能是 Vaultly 密码管理器的核心安全入口，负责验证用户身份并控制对加密保险库的访问。该功能包含主密码设置、主密码验证、生物识别解锁、自动锁定等子功能。

### 1.2 用户场景

#### 场景 1：首次使用设置主密码
> 作为新用户，我希望设置一个强主密码来保护我的保险库，以便安全地存储敏感信息。

**用户旅程：**
1. 首次打开应用，看到欢迎界面
2. 系统提示设置主密码
3. 输入主密码并确认
4. 系统显示密码强度
5. 设置成功，进入保险库

#### 场景 2：日常使用解锁
> 作为日常用户，我希望快速解锁保险库查看密码，同时保证安全性。

**用户旅程：**
1. 打开应用，显示锁定界面
2. 选择解锁方式：主密码或生物识别
3. 输入主密码 / 使用指纹/Face ID
4. 解锁成功，进入保险库主界面

#### 场景 3：自动锁定保护
> 作为安全意识强的用户，我希望应用在闲置一段时间后自动锁定，防止他人访问。

**用户旅程：**
1. 在设置中配置自动锁定时间（5/15/30分钟）
2. 正常使用应用
3. 闲置超过设定时间
4. 应用自动锁定，需要重新认证

#### 场景 4：修改主密码
> 作为用户，我希望能够修改主密码，以便定期更新或应对安全疑虑。

**用户旅程：**
1. 进入设置 → 安全设置
2. 选择"修改主密码"
3. 输入当前主密码验证
4. 输入新主密码并确认
5. 系统使用新密码重新加密所有数据

---

## 二、功能需求

### 2.1 功能清单

| 功能 ID | 功能名称 | 优先级 | 描述 |
|---------|---------|--------|------|
| AUTH-001 | 主密码设置 | P0 | 首次使用时设置主密码 |
| AUTH-002 | 主密码验证 | P0 | 使用主密码解锁保险库 |
| AUTH-003 | 生物识别解锁 | P0 | 支持指纹/Face ID/Windows Hello |
| AUTH-004 | 自动锁定 | P1 | 闲置后自动锁定应用 |
| AUTH-005 | 修改主密码 | P1 | 更改主密码并重新加密数据 |
| AUTH-006 | 密码强度检测 | P1 | 实时显示密码强度评分 |
| AUTH-007 | 生物识别设置 | P2 | 启用/禁用生物识别解锁 |
| AUTH-008 | 安全提示 | P2 | 弱密码警告、安全建议 |

### 2.2 主密码要求

| 要求项 | 规则 | 说明 |
|--------|------|------|
| 最小长度 | 8 位 | 强制要求 |
| 最大长度 | 128 位 | 防止 DoS |
| 字符类型 | 至少包含大写、小写、数字中的两种 | 基础强度要求 |
| 强度等级 | 弱/中/强/极强 | 基于熵值计算 |
| 禁止密码 | 常见弱密码黑名单 | 如 "123456", "password" |

### 2.3 生物识别支持

| 平台 | 生物识别类型 | 支持状态 |
|------|-------------|---------|
| iOS | Face ID / Touch ID | ✅ 支持 |
| Android | 指纹 / 面部识别 | ✅ 支持 |
| Windows | Windows Hello | ✅ 支持 |
| macOS | Touch ID | ✅ 支持 |
| Linux | 依赖硬件 | ⚠️ 有限支持 |

---

## 三、用户界面

### 3.1 界面清单

| 界面 | 描述 | 关键元素 |
|------|------|---------|
| 欢迎页 | 首次使用引导 | Logo、开始按钮、隐私说明 |
| 设置主密码 | 创建主密码 | 密码输入框、确认框、强度指示器 |
| 解锁页 | 日常解锁 | 密码输入框、生物识别按钮、忘记密码提示 |
| 安全设置 | 认证相关设置 | 修改密码、生物识别开关、自动锁定时间 |

### 3.2 界面原型

```
┌─────────────────────────────┐
│         Vaultly             │
│                             │
│      ┌─────────────┐        │
│      │     🔒      │        │
│      │   Locked    │        │
│      └─────────────┘        │
│                             │
│   ┌─────────────────────┐   │
│   │  Enter Master       │   │
│   │  Password           │   │
│   └─────────────────────┘   │
│                             │
│      🔓  Unlock             │
│                             │
│   ┌─────────────────────┐   │
│   │  👆 Use Biometrics  │   │
│   └─────────────────────┘   │
│                             │
└─────────────────────────────┘
```

---

## 四、验收标准

### 4.1 功能验收

| 验收项 | 验收标准 | 测试方法 |
|--------|---------|---------|
| 主密码设置 | 新用户必须设置主密码才能使用 | 端到端测试 |
| 主密码验证 | 正确密码解锁，错误密码拒绝 | 单元测试 |
| 生物识别 | 生物识别成功则解锁，失败则回退到密码 | 集成测试 |
| 自动锁定 | 闲置后自动锁定，计时准确 | 手动测试 |
| 修改密码 | 修改后使用新密码可解锁，旧密码失效 | 端到端测试 |

### 4.2 性能验收

| 指标 | 目标值 | 测量方法 |
|------|--------|---------|
| 解锁响应时间 | < 500ms | 性能测试 |
| 生物识别响应 | < 1s | 性能测试 |
| 密码强度计算 | < 100ms | 性能测试 |

### 4.3 安全验收

| 验收项 | 验收标准 |
|--------|---------|
| 密码存储 | 主密码不以明文存储，仅存储 Argon2id 哈希 |
| 密钥派生 | 使用 Argon2id，参数符合安全标准 |
| 内存安全 | 敏感数据使用后立即清除 |
| 防暴力破解 | 验证失败后有延迟或限制 |

---

## 五、相关文档

- [用户认证需求文档](../需求文档/用户认证需求.md) - 数据模型、数据流动、状态管理
- [用户认证架构文档](../架构文档/用户认证架构.md) - 技术选型、实现方案
- [认证状态机](../状态机/认证状态机.md) - 状态转换设计
- [认证数据流](../数据流动/用户登录数据流.md) - 数据流动设计

---

## 六、变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|---------|------|
| v1.0 | 2026-02-20 | 初始版本 | Vaultly Team |
